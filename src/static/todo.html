<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/main.css" crossorigin="">
    <title>å¾…åŠäº‹é¡¹ - åç«¯æ¥å£ç‰ˆ</title>
    <style>
 
    </style>
</head>
<body>    
    <!--#content-->
    <div class="container">
        <header>
            <h1 class="app-title">å¾…åŠäº‹é¡¹ç®¡ç†</h1>
        </header>
        
        <main class="main-content">
            <div class="todo-form">
                <div class="form-group">
                    <input type="text" class="todo-input" id="todo-input" placeholder="è¾“å…¥æ–°çš„å¾…åŠäº‹é¡¹...">
                    <button class="add-btn" id="add-btn">æ·»åŠ </button>
                </div>
            </div>
            
            <div class="todo-stats">
                <div class="stat-item">
                    <div class="stat-value" id="total-count">0</div>
                    <div class="stat-label">æ€»ä»»åŠ¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="pending-count">0</div>
                    <div class="stat-label">å¾…å®Œæˆ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completed-count">0</div>
                    <div class="stat-label">å·²å®Œæˆ</div>
                </div>

            </div>
            
            <div class="todo-list-container">
                <div class="todo-list" id="todo-list">
                    <!-- Todo items will be loaded here -->
                </div>
            </div>
        </main>
    </div>

    <script>
        // åˆå§‹æ•°æ® - ä½¿ç”¨æä¾›çš„JSON
        const initialTodos = [
            {"id":2,"todo":"googgogogogogogog","status":false},
            {"id":3,"todo":"ä½ æ„¿æœ›å®ç°äº†å—","status":true},
            {"id":4,"todo":"ä½ æ„¿æœ›å®ç°äº†å—","status":true},
            {"id":1,"todo":"ä»Šå¤©å¹²è¿™ä¸ª","status":true}
        ];
        
        // çŠ¶æ€ç®¡ç†
        let todos = [];
        let apiBaseUrl = '';
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½å¾…åŠäº‹é¡¹åˆ—è¡¨
            loadTodos();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
        });
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('add-btn').addEventListener('click', addNewTodo);
            
            // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            document.getElementById('todo-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addNewTodo();
                }
            });
        }
        
        // API è°ƒç”¨å°è£…
        class TodoApi {
            constructor(baseUrl = '') {
                this.baseUrl = "/";
            }
            
            // è·å–æ‰€æœ‰å¾…åŠäº‹é¡¹
            async getAll() {
                return this.fetchFromRealApi(`/`, { method: 'GET'});
            }
            
            // æ·»åŠ å¾…åŠäº‹é¡¹
            async add(todo) {
                return this.fetchFromRealApi(`/add`, {
                    method: 'POST',
                    body: todo,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                });
            }
            
            // æ›´æ–°å¾…åŠäº‹é¡¹
            async update(id, updates) {
                return this.fetchFromRealApi(`/change`, {
                    method: 'PUT',
                    body: `${id}`,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                });
            }

            async fetchFromRealApi(url, options) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    // å°è¯•è§£æ JSONï¼Œå¦‚æœå“åº”æ˜¯ç©ºçš„ï¼ˆå¦‚ DELETEï¼‰ï¼Œåˆ™è¿”å› null
                    const text = await response.text();
                    console.log("hahaha" + text);
                    if (!text) return { success: true, data: null };
                    return { success: true, data: JSON.parse(text) };
                } catch (error) {
                    console.error('API è¯·æ±‚å¤±è´¥:', error);
                    return { 
                        success: false, 
                        error: error.message,
                        data: null 
                    };
                }
            }
        }
        
        // åˆ›å»º API å®ä¾‹
        let todoApi = new TodoApi(apiBaseUrl);
        
        // åŠ è½½å¾…åŠäº‹é¡¹
        async function loadTodos() {
            // æ›´æ–° API å®ä¾‹
            todoApi = new TodoApi(apiBaseUrl);
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            renderLoadingState();
            
            // è°ƒç”¨ API
            const result = await todoApi.getAll();
            
            // å¤„ç†ç»“æœ
            if (result.success) {
                todos = result.data || [];
                
                // å¦‚æœæ²¡æœ‰æ•°æ®ä¸”æ˜¯æ¨¡æ‹Ÿæ¥å£ï¼Œåˆå§‹åŒ–æ•°æ®
                if (todos.length === 0 && !apiBaseUrl) {
                    // ä½¿ç”¨åˆå§‹æ•°æ®
                    todos = [...initialTodos];
                }
                
                // æ¸²æŸ“åˆ—è¡¨
                renderTodoList();
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateStats();
            } else {
                // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
                renderErrorState(result.error);
            }
        }
        
        // æ¸²æŸ“åŠ è½½çŠ¶æ€
        function renderLoadingState() {
            const todoListEl = document.getElementById('todo-list');
            todoListEl.innerHTML = `
                <div class="loading-state">
                    <div class="loading-icon">â³</div>
                    <h3 class="loading-title">æ­£åœ¨åŠ è½½å¾…åŠäº‹é¡¹...</h3>
                    <p>è¯·ç¨å€™</p>
                </div>
            `;
        }
        
        // æ¸²æŸ“é”™è¯¯çŠ¶æ€
        function renderErrorState(errorMessage) {
            const todoListEl = document.getElementById('todo-list');
            todoListEl.innerHTML = `
                <div class="error-state">
                    <div class="error-icon">âš ï¸</div>
                    <h3 class="error-title">åŠ è½½å¤±è´¥</h3>
                    <p class="error-description">${errorMessage}</p>
                    <button style="margin-top: 20px; padding: 10px 20px; background-color: var(--primary-color); color: white; border: none; border-radius: var(--border-radius); cursor: pointer;" onclick="loadTodos()">
                        é‡è¯•
                    </button>
                </div>
            `;
        }
        
        // æ¸²æŸ“å¾…åŠäº‹é¡¹åˆ—è¡¨
        function renderTodoList() {
            const todoListEl = document.getElementById('todo-list');
            
            // å¦‚æœæ²¡æœ‰å¾…åŠäº‹é¡¹ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
            if (todos.length === 0) {
                todoListEl.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <h3 class="empty-title">æš‚æ— å¾…åŠäº‹é¡¹</h3>
                        <p class="empty-description">æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå¼€å§‹é«˜æ•ˆç®¡ç†æ‚¨çš„å·¥ä½œå’Œç”Ÿæ´»ã€‚</p>
                    </div>
                `;
                return;
            }
            
            // æ¸²æŸ“æ‰€æœ‰å¾…åŠäº‹é¡¹
            todoListEl.innerHTML = todos.map(todo => createTodoItemHTML(todo)).join('');
            
            // ä¸ºæ¯ä¸ªå¾…åŠäº‹é¡¹æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            attachTodoEventListeners();
        }
        
        // åˆ›å»ºå•ä¸ªå¾…åŠäº‹é¡¹çš„HTML
        function createTodoItemHTML(todo) {
            const statusClass = todo.status ? 'completed' : 'pending';
            const statusText = todo.status ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ';
            
            return `
                <div class="todo-item ${todo.status ? 'completed' : ''}" data-id="${todo.id}">
                    <div class="todo-checkbox-container">
                        <input type="checkbox" class="todo-checkbox" id="checkbox-${todo.id}" ${todo.status ? 'checked' : ''}>
                        <label for="checkbox-${todo.id}" class="todo-text">${todo.todo}</label>
                        <br />
                        <span class="todo-status ${statusClass}">${statusText}</span>
                    </div>
                </div>
            `;
        }
        
        // ä¸ºå¾…åŠäº‹é¡¹æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        function attachTodoEventListeners() {
            // å¤é€‰æ¡†ç‚¹å‡»äº‹ä»¶ - åˆ‡æ¢å®ŒæˆçŠ¶æ€
            document.querySelectorAll('.todo-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const todoId = parseInt(this.id.replace('checkbox-', ''));
                    toggleTodoStatus(todoId, this.checked);
                });
            });
        }
        
        // æ·»åŠ æ–°çš„å¾…åŠäº‹é¡¹
        async function addNewTodo() {
            const inputEl = document.getElementById('todo-input');
            const todoText = inputEl.value.trim();
            
            if (!todoText) {
                showNotification('è¯·è¾“å…¥å¾…åŠäº‹é¡¹å†…å®¹', 'warning');
                inputEl.focus();
                return;
            }
            
            // è°ƒç”¨ API æ·»åŠ 
            const result = await todoApi.add(todoText);
            
            if (result.success) {
                // æ¸…ç©ºè¾“å…¥æ¡†
                inputEl.value = '';
                
                // é‡æ–°åŠ è½½åˆ—è¡¨
                loadTodos();
                
                // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
                showNotification('å¾…åŠäº‹é¡¹æ·»åŠ æˆåŠŸ', 'success');
            } else {
                // æ˜¾ç¤ºé”™è¯¯é€šçŸ¥
                showNotification(`æ·»åŠ å¤±è´¥: ${result.error}`, 'danger');
            }
        }
        
        // åˆ‡æ¢å¾…åŠäº‹é¡¹çŠ¶æ€
        async function toggleTodoStatus(id, completed) {
            // è°ƒç”¨ API æ›´æ–°
            const result = await todoApi.update(id, { status: completed });
            
            if (result.success) {
                // é‡æ–°åŠ è½½åˆ—è¡¨
                loadTodos();
                
                // æ˜¾ç¤ºé€šçŸ¥
                const statusText = completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ';
                showNotification(`ä»»åŠ¡çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"`, 'info');
            } else {
                // æ˜¾ç¤ºé”™è¯¯é€šçŸ¥
                showNotification(`æ›´æ–°å¤±è´¥: ${result.error}`, 'danger');
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const total = todos.length;
            const completed = todos.filter(todo => todo.status).length;
            const pending = total - completed;
            
            document.getElementById('total-count').textContent = total;
            document.getElementById('completed-count').textContent = completed;
            document.getElementById('pending-count').textContent = pending;
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            // è®¾ç½®èƒŒæ™¯é¢œè‰²
            const colors = {
                success: '#4cc9f0',
                danger: '#f72585',
                warning: '#f8961e',
                info: '#007ACC'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(notification);
            
            // è§¦å‘åŠ¨ç”»
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            // 3ç§’åç§»é™¤
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100px)';
                
                // åŠ¨ç”»å®Œæˆåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // å¯¼å‡ºå‡½æ•°ä¾›è°ƒè¯•
        window.loadTodos = loadTodos;
        window.todos = todos;
    </script>
</body>
</html>